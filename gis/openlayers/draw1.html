<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>draw详解 | 等等风吧</title>
    <meta name="description" content="等等风的个人博客">
    <link rel="apple-touch-icon" href="/Blog/apple-touch-icon.png">
  <link rel="icon" href="/Blog/favicon-32x32.png">
  <link rel="manifest" href="/Blog/manifest.json">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.f4f6d0f1.css" as="style"><link rel="preload" href="/Blog/assets/js/app.0ad31845.js" as="script"><link rel="preload" href="/Blog/assets/js/2.1b5dd912.js" as="script"><link rel="preload" href="/Blog/assets/js/15.8552bcca.js" as="script"><link rel="preload" href="/Blog/assets/js/4.a1875dba.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.136c3538.js"><link rel="prefetch" href="/Blog/assets/js/11.12bceb81.js"><link rel="prefetch" href="/Blog/assets/js/12.c0e97e00.js"><link rel="prefetch" href="/Blog/assets/js/13.98392899.js"><link rel="prefetch" href="/Blog/assets/js/14.1a016337.js"><link rel="prefetch" href="/Blog/assets/js/16.458a1e33.js"><link rel="prefetch" href="/Blog/assets/js/17.67ad1ebe.js"><link rel="prefetch" href="/Blog/assets/js/18.e3a80131.js"><link rel="prefetch" href="/Blog/assets/js/19.7e8621a9.js"><link rel="prefetch" href="/Blog/assets/js/20.cd4ef131.js"><link rel="prefetch" href="/Blog/assets/js/21.d0904527.js"><link rel="prefetch" href="/Blog/assets/js/22.49895c6b.js"><link rel="prefetch" href="/Blog/assets/js/23.86d794cd.js"><link rel="prefetch" href="/Blog/assets/js/24.e31324ae.js"><link rel="prefetch" href="/Blog/assets/js/25.b8433c7d.js"><link rel="prefetch" href="/Blog/assets/js/26.6b1a1ab1.js"><link rel="prefetch" href="/Blog/assets/js/27.9381e493.js"><link rel="prefetch" href="/Blog/assets/js/28.7d39c37b.js"><link rel="prefetch" href="/Blog/assets/js/29.866cb72b.js"><link rel="prefetch" href="/Blog/assets/js/3.aba7f2b2.js"><link rel="prefetch" href="/Blog/assets/js/30.0aa32a81.js"><link rel="prefetch" href="/Blog/assets/js/31.44290afc.js"><link rel="prefetch" href="/Blog/assets/js/32.3cf2a1f9.js"><link rel="prefetch" href="/Blog/assets/js/33.71d68c25.js"><link rel="prefetch" href="/Blog/assets/js/34.5c6eedf2.js"><link rel="prefetch" href="/Blog/assets/js/35.8e4b784e.js"><link rel="prefetch" href="/Blog/assets/js/36.3da44658.js"><link rel="prefetch" href="/Blog/assets/js/37.4accd394.js"><link rel="prefetch" href="/Blog/assets/js/38.aa2bb673.js"><link rel="prefetch" href="/Blog/assets/js/39.4c249910.js"><link rel="prefetch" href="/Blog/assets/js/40.90359bf7.js"><link rel="prefetch" href="/Blog/assets/js/41.ddce87f5.js"><link rel="prefetch" href="/Blog/assets/js/42.7e8c7a2d.js"><link rel="prefetch" href="/Blog/assets/js/43.ef98017e.js"><link rel="prefetch" href="/Blog/assets/js/44.aa779bb0.js"><link rel="prefetch" href="/Blog/assets/js/5.c75dcd3b.js"><link rel="prefetch" href="/Blog/assets/js/6.7e1b8072.js"><link rel="prefetch" href="/Blog/assets/js/7.35f20a04.js"><link rel="prefetch" href="/Blog/assets/js/8.fa8588d8.js"><link rel="prefetch" href="/Blog/assets/js/9.dff8b2a7.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.f4f6d0f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">等等风吧</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/web/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/javascript/" class="nav-link">javascript</a></li></ul></div></div><div class="nav-item"><a href="/Blog/backend/" class="nav-link">后端</a></div><div class="nav-item"><a href="/Blog/sql/" class="nav-link">数据库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Gis</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/gis/OGC/" class="nav-link">OGC</a></li><li class="dropdown-item"><!----> <a href="/Blog/gis/openlayers/" class="nav-link router-link-active">openlayers</a></li></ul></div></div><div class="nav-item"><a href="/Blog/about/" class="nav-link">大杂烩</a></div><div class="nav-item"><a href="/Blog/wen/" class="nav-link">好文欣赏</a></div><div class="nav-item"><a href="/Blog/guide/" class="nav-link">Guide</a></div> <a href="https://github.com/dengdengfengba/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/web/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/Blog/web/javascript/" class="nav-link">javascript</a></li></ul></div></div><div class="nav-item"><a href="/Blog/backend/" class="nav-link">后端</a></div><div class="nav-item"><a href="/Blog/sql/" class="nav-link">数据库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Gis</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/gis/OGC/" class="nav-link">OGC</a></li><li class="dropdown-item"><!----> <a href="/Blog/gis/openlayers/" class="nav-link router-link-active">openlayers</a></li></ul></div></div><div class="nav-item"><a href="/Blog/about/" class="nav-link">大杂烩</a></div><div class="nav-item"><a href="/Blog/wen/" class="nav-link">好文欣赏</a></div><div class="nav-item"><a href="/Blog/guide/" class="nav-link">Guide</a></div> <a href="https://github.com/dengdengfengba/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>openlayers</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/gis/openlayers/" class="sidebar-link">首页</a></li><li><a href="/Blog/gis/openlayers/map.html" class="sidebar-link">创建一个地图实例</a></li><li><a href="/Blog/gis/openlayers/view.html" class="sidebar-link">地图视图</a></li><li><a href="/Blog/gis/openlayers/layers.html" class="sidebar-link">地图图层</a></li><li><a href="/Blog/gis/openlayers/vector.html" class="sidebar-link">地图矢量图层</a></li><li><a href="/Blog/gis/openlayers/source.html" class="sidebar-link">地图图层数据来源</a></li><li><a href="/Blog/gis/openlayers/style.html" class="sidebar-link">地图样式</a></li><li><a href="/Blog/gis/openlayers/control.html" class="sidebar-link">地图控件</a></li><li><a href="/Blog/gis/openlayers/interaction.html" class="sidebar-link">地图交互</a></li><li><a href="/Blog/gis/openlayers/draw1.html" class="active sidebar-link">draw详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#clicktolerance" class="sidebar-link">clickTolerance</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#features" class="sidebar-link">features</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#snaptolerance" class="sidebar-link">snapTolerance</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#maxpoints-minpoints" class="sidebar-link">maxPoints &amp; minPoints</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#geometryfunction" class="sidebar-link">geometryFunction</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#geometryname" class="sidebar-link">geometryName</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#condition" class="sidebar-link">condition</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#freehandcondition" class="sidebar-link">freehandCondition</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#wrapx" class="sidebar-link">wrapX</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/Blog/gis/openlayers/draw1.html#相关链接" class="sidebar-link">相关链接</a></li></ul></li><li><a href="/Blog/gis/openlayers/draw2.html" class="sidebar-link">draw原理</a></li><li><a href="/Blog/gis/openlayers/overlay.html" class="sidebar-link">地图覆盖物</a></li><li><a href="/Blog/gis/openlayers/popup.html" class="sidebar-link">地图弹出框</a></li><li><a href="/Blog/gis/openlayers/control1.html" class="sidebar-link">地图自定义控件</a></li><li><a href="/Blog/gis/openlayers/event.html" class="sidebar-link">地图事件</a></li><li><a href="/Blog/gis/openlayers/event1.html" class="sidebar-link">地图鼠标右键事件</a></li><li><a href="/Blog/gis/openlayers/point1.html" class="sidebar-link">地图点聚集</a></li><li><a href="/Blog/gis/openlayers/point2.html" class="sidebar-link">动态点扩散效果</a></li><li><a href="/Blog/gis/openlayers/point3.html" class="sidebar-link">地图实时追踪轨迹</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="介绍"><a href="#介绍" aria-hidden="true" class="header-anchor">#</a> 介绍</h2> <p>Ol中负责勾绘交互的是 interaction 中的 <code>draw interaction</code>，默认支持绘制的图形类型包含 <code>Point</code>（点）、<code>LineString</code>（线）、<code>Polygon</code>（面）和<code>Circle</code>（圆）。</p> <p>触发的事件包含 <code>drawstart</code>和<code>drawend</code>，分别在勾绘开始时候（单击鼠标）和结束时候触发（双击鼠标），利用 ol 给一个 Web 地图添加勾绘交互很简单，在地图初始化的时候添加这个交互或者后续追加：</p> <p>初始化 map 时添加 draw interaction：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token punctuation">:</span> source
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    interactions<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            source<span class="token punctuation">:</span> source<span class="token punctuation">,</span>
            type<span class="token punctuation">:</span> <span class="token string">'Polygon'</span><span class="token punctuation">,</span>
            style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    color<span class="token punctuation">:</span> <span class="token string">'rgba(255, 255, 255, 0.2)'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span><span class="token punctuation">,</span>
                    width<span class="token punctuation">:</span> <span class="token number">2</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    radius<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
                    fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    target<span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>
    layers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        vector
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    view<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          center<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'EPSG:4326'</span><span class="token punctuation">,</span> <span class="token string">'EPSG:3857'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          zoom<span class="token punctuation">:</span> <span class="token number">12</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>后续添加 draw interaction：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    target<span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>
    layers<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        vector
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    view<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          center<span class="token punctuation">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'EPSG:4326'</span><span class="token punctuation">,</span> <span class="token string">'EPSG:3857'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          zoom<span class="token punctuation">:</span> <span class="token number">12</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">var</span> draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token punctuation">:</span> source<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'Polygon'</span><span class="token punctuation">,</span>
    style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span> <span class="token string">'rgba(255, 255, 255, 0.2)'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span><span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            radius<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
            fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>无论采用哪种方式，执行的结果会是下图这样，点击鼠标左键，逐一添加多半形的顶点：</p> <p><img src="https://img-blog.csdn.net/20150920130238467" alt="markdown" title="markdown"></p> <p>需要指出的是，当勾绘多边形超过三个点时，我们完成多边形的方式有两种，一种是在最后一个点进行双击，这样会根据现存的点围成一个多边形；另一种是将绘制最后一个点时，与第一个点重合，但是手动肯定会有误差，所以这里就用到了吸附，就是当鼠标靠近一个矢量点一定距离时，会自动吸附到相应的矢量点。</p> <p><img src="https://img-blog.csdn.net/20150920140411710" alt="markdown" title="markdown"></p> <p>我们看到初始化 draw interaction 需要一些可选参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token punctuation">:</span> source<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'Polygon'</span><span class="token punctuation">,</span>
    style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span> <span class="token string">'rgba(255, 255, 255, 0.2)'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span><span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            radius<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
            fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里指定了三个参数，<code>source</code> 表示勾绘的要素属于的数据集，这里是属于一个矢量图层 <code>vector</code> 的矢量数据集 <code>source</code>。这样勾绘的要素就会添加到 <code>source</code> 所属的矢量图层，我们才可以看到勾绘的结果；type 表示勾绘的要素包含的 <code>geometry</code> 类型，这里是多边形；style 表示勾绘的要素的样式。其他更多的参数选项有：<code>clickTolerance</code>、<code>snapTolerance</code>、<code>source</code>、<code>minPoints</code>、<code>maxPoints</code>、<code>geometryFunction</code>、<code>geometryName</code>、<code>condition</code>、<code>freehandCondition</code>、<code>wrapX</code>。</p> <h2 id="clicktolerance"><a href="#clicktolerance" aria-hidden="true" class="header-anchor">#</a> clickTolerance</h2> <p>数值类型，单位是像素，判断用户鼠标（PC）或者手指（移动设备）的行为是添加点，还是按住鼠标或者手指不松开进行拖拽地图，默认值是 6 像素，也就是说当按下鼠标和抬起鼠标左键之间的这段时间段内，如果地图被拖动没有超过 6 像素，那么默认为添加一个点，相反如果超过了 6 像素，那么不会添加点，只是平移一下地图。</p> <h2 id="features"><a href="#features" aria-hidden="true" class="header-anchor">#</a> features</h2> <p>绘制的要素所属的要素集合，要素集合（featureCollection）是要素集（source）的一个子集，要素集包含要素集合。要素集合添加到要素集（source），才会显示到 source 所属的矢量图层。这个参数和 source 参数很类似。</p> <h2 id="snaptolerance"><a href="#snaptolerance" aria-hidden="true" class="header-anchor">#</a> snapTolerance</h2> <p>数值，像素为单位，默认值是 12 像素。上面我们提到完成多边形时，可以把最后一个点与第一个点重合来完成，那么我们知道重合很难做到，只有吸附才能做到精确重合。上图可以看到鼠标所指的位置和吸附的矢量点还有一定的距离，也就是说当鼠标位置进入以矢量点为圆心，一定距离为半径的圆范围内，就会被吸附到相应的矢量点。具体的值就是在这里设置的。</p> <p>我们改变一下 snapTolerance 的值，对比一下效果，首先我们设置 snapTolerance 为 默认：</p> <p><img src="https://img-blog.csdn.net/20150920140411710" alt="markdown" title="markdown"></p> <p>为了更好的看到效果，更改 snapTolerance 为50，如图：</p> <p><img src="https://img-blog.csdn.net/20150920155015219" alt="markdown" title="markdown"></p> <p>可以明显看到鼠标所在位置和吸附点的位置变大，需要指出的是吸附选项只会吸附起始点和当前的最后一个点，且只会吸附当前绘制的多边形。</p> <h2 id="maxpoints-minpoints"><a href="#maxpoints-minpoints" aria-hidden="true" class="header-anchor">#</a> maxPoints &amp; minPoints</h2> <p>都是数值类型，maxPoints 表示绘制单个要素（面和线）最多的点数限制，默认没有限制；minPoints 表示绘制单个要素（面和线）需要的最少点数，面默认为 3，线默认为 2。</p> <h2 id="geometryfunction"><a href="#geometryfunction" aria-hidden="true" class="header-anchor">#</a> geometryFunction</h2> <p>默认的绘制类型只有四种类型，如果我想绘制一个矩形框呢？当然有一个拉框交互可以实现这个效果，这里我们使用 draw 交互来实现拉框的效果，这个要结合 maxPoints 加以限制。</p> <p>该函数有两个参数，一个是坐标集合、一个是勾绘的 geometry 类型，返回构造好的 geometry 对象，用来初始化要素。如下，我们给 draw 增加 geometryFunction 参数和 maxPoints 参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token punctuation">:</span> source<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'LineString'</span><span class="token punctuation">,</span>
    style<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span> <span class="token string">'rgba(255, 255, 255, 0.2)'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stroke<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span><span class="token punctuation">,</span>
            width<span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        image<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            radius<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
            fill<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>style<span class="token punctuation">.</span>Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                color<span class="token punctuation">:</span> <span class="token string">'#ffcc33'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    maxPoints<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token function-variable function">geometryFunction</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">coordinates<span class="token punctuation">,</span> geometry</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>geometry<span class="token punctuation">)</span><span class="token punctuation">{</span>
            geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>geom<span class="token punctuation">.</span>Polygon</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> start <span class="token operator">=</span> coordinates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> end <span class="token operator">=</span> coordinates<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        geometry<span class="token punctuation">.</span><span class="token function">setCoordinates</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token punctuation">[</span>start<span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token punctuation">,</span> <span class="token punctuation">[</span>end<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> start<span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> geometry<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>注意到我修改了 type 属性，为勾绘 LineString，也就是线。这里的原理就是捕捉鼠标点击的点，然后获取限制的两个点的坐标，用来初始化一个矩形框。运行结果如图：</p> <p><img src="https://img-blog.csdn.net/20150920165759886" alt="markdown" title="markdown"></p> <h2 id="geometryname"><a href="#geometryname" aria-hidden="true" class="header-anchor">#</a> geometryName</h2> <p>字符串类型，绘制的 geometry 的名称。</p> <h2 id="condition"><a href="#condition" aria-hidden="true" class="header-anchor">#</a> condition</h2> <p>类型为 ol.events.ConditionType，规定了什么情况下触发 draw 操作，默认不需要特殊条件进行触发。</p> <h2 id="freehandcondition"><a href="#freehandcondition" aria-hidden="true" class="header-anchor">#</a> freehandCondition</h2> <p>类型同condition，也是 ol.events.ConditionType，这个选项规定了什么情况下触发不用重复点击绘制模式，即拖拽鼠标就可以绘制图形的模式，默认情况下是按下 shift 按键，这种模式对于不容易绘制的曲线比较方便，而且释放 shift 情况下，如果没有完成绘制，可以继续使用点击绘制。</p> <h2 id="wrapx"><a href="#wrapx" aria-hidden="true" class="header-anchor">#</a> wrapX</h2> <p>当地图水平显示多个相同位置时，是否显示多个勾绘任务，默认为 false，设置为 true，效果如下：</p> <p><img src="https://img-blog.csdn.net/20150920173011811" alt="markdown" title="markdown"></p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>利用 Draw 交互可以创作出很多有用的功能，比如做一个可以支持缩放和平移的绘图板；还可以新建一个矢量图层，覆盖在底图上，然后描出地图的轮廓，这样便可以进行简单的数字化；或者在地图上勾绘一下矢量图斑，保存到数据库，来完成一下编辑操作等等的任务。</p> <h2 id="相关链接"><a href="#相关链接" aria-hidden="true" class="header-anchor">#</a> 相关链接</h2> <p><a href="https://blog.csdn.net/qingyafan/article/details/48622467" target="_blank" rel="noopener noreferrer">CSDN庆祝亚运会<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dengdengfengba/Blog/edit/master/docs/gis/openlayers/draw1.md" target="_blank" rel="noopener noreferrer">编辑该文档</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019-10-6 17:16:27</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Blog/gis/openlayers/interaction.html" class="prev">地图交互</a></span> <span class="next"><a href="/Blog/gis/openlayers/draw2.html">draw原理</a>→
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/Blog/assets/js/app.0ad31845.js" defer></script><script src="/Blog/assets/js/2.1b5dd912.js" defer></script><script src="/Blog/assets/js/15.8552bcca.js" defer></script><script src="/Blog/assets/js/4.a1875dba.js" defer></script>
  </body>
</html>
